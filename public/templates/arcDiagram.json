{  
  "x": 700,  

  "zoom": true,
  "pan": {
    "modifierKeyRequired": null
  },

  "data": "[dataDefinition]",
  "networks": "[networksDefinition]",

  "parameters": [
    {
      "name": "node_selection",
      "network": "network",
      "type": "selection",
      "clearOnBackgroundClick": true
    },
    {
      "name": "neighbours",
      "source": "node_selection",
      "transform": [
        { "type": "neighbours", "direction": "both" }
      ]
    },
    {
      "name": "seriationMethod",
      "bind": {
          "input": "select",
          "options":  [ 
            "optimal-leaf-order", 
            "barycentre", 
            "bandwidth-reduction", 
            "pca", 
            "degree_order" ],
          "labels":  [ 
            "Optimal Leaf Order", 
            "Barycentre Heuristic", 
            "Bandwidth Reduction", 
            "PCA", 
            "Node Degree" ],
          "label": "Seriation"
      },
      "value": "optimal-leaf-order"

    },
    {
      "name": "timeRange",
      "value": "[timeRange]"
    },
    {
      "name": "nodeTypeInShape",
      "value": "[nodeTypeInShape]"
    },
    {
      "name": "linkWidthParam",
      "bind": {
        "input": "range",
        "label": "Link Width",
        "min": "0",
        "max": "5",
        "step": "1"
      },
      "value": 1
    },
    {
      "name": "linkOpacityParam",
      "bind": {
        "input": "range",
        "label": "Link Opacity",
        "min": "0",
        "max": "1",
        "step": "0.05"
      },
      "value": 0.6
    }
  ],

  "scales": [
    {
      "name": "radius",
      "type": "linear",
      "range": [ 15, 150 ],
      "domain": { "data": "network.nodes",  "field": "degree" }
    },
    {
      "name": "nodeShape",
      "type": "ordinal",
      "range": "[nodeTypeShapeScheme]",
      "domain": { "data": "network.nodes",  "field": "data.type0" }
    },
    {
      "name": "nodeColor",
      "type": "ordinal",
      "range": "[colorScheme]",
      "domain": { "data": "network.nodes",  "field": "data.type0" }
    },
    {
      "name": "edgeColor",
      "type": "ordinal",
      "range": "[colorScheme]",
      "domain": { "data": "network.links", "field": "linkType" }
    },
    {
      "name": "edgeWidth",
      "type": "linear",
      "range": [ 1, 10],
      "rangeMapFunction": "datum * params.linkWidthParam",
      "domain": { "data": "network.links", "field": "linkWeight" }
    },
    {
      "name": "edgeOpacity",
      "type": "linear",
      "range": [0, 0.8],
      "rangeMapFunction": "datum * params.linkOpacityParam",
      "domain": { "data": "network.links", "field": "linkWeight" }
    } 
  ],

  "orderings": [
    {
      "name": "node_order",
      "data": "network.nodes",
      "orderBy": {"parameter": "seriationMethod"}
    }
  ],

  "layouts": [
    {
      "name": "layout",
      "data": "network.nodes",
      "pattern": "linear",
      "order": "node_order",
      "orientation": "vertical"
    }
  ],

  "vis": [
    {
      "entries": "network.links",
      "layout": "layout",
      "mark": {
        "type": "linkpath",
        "start": "source",
        "end": "target",
        "directionForShape": { "ordering": "node_order"},
        "strokeWidth": { 
          "expression": "0.1 * datum.linkWeight * params.linkWidthParam"
        },
        "shape": "arc",
        "strokeOpacity": {
          "conditions": [
            {
              "selectionIsEmpty": "node_selection.nodes",
              "expression": "params.linkOpacityParam"
            },
            {
              "inSelection": "neighbours.links",
              "expression": "params.linkOpacityParam"
            }
          ],
          "value": 0.05
        }
      }
    },

    {
      "entries": "network.nodes",
      "layout": "layout",
      "actions": [
        {
          "interaction": "select",
          "using": "cursor",
          "event": "mouseover",
          "action": "replace",
          "selection": "node_selection"
        },
        {
          "interaction": "select",
          "using": "cursor",
          "event": "mouseout",
          "action": "remove",
          "selection": "node_selection"
        }
      ],
      "mark": {
        "type": "symbol",
        "shape": {
          "conditions": [
            {
              "test": "!params.nodeTypeInShape",
              "value": "circle"
            }
          ],
          "field": "data.type0",
          "scale": "nodeShape"
        },
        "area": {
          "field": "degree",
          "scale": "radius"
        },
        "fill": {
          "conditions": [
            {
              "test": "params.nodeTypeInShape",
              "value": "black"
            }
          ],
          "field": "data.type0",
          "scale": "nodeColor"
        },
        "stroke": "white",
        "opacity": {
          "conditions": [
            {
              "selectionIsEmpty": "node_selection.nodes",
              "value": 1
            },
            {
              "inSelection": "node_selection.nodes",
              "value": 1
            },
            {
              "inSelection": "neighbours.nodes",
              "value": 1
            }
          ],
          "value": 0.1
        }
      }
    },

    {
      "entries": "network.nodes",
      "layout": "layout",
      "actions": [
        {
          "interaction": "select",
          "using": "cursor",
          "event": "mouseover",
          "action": "replace",
          "selection": "node_selection"
        },
        {
          "interaction": "select",
          "using": "cursor",
          "event": "mouseout",
          "action": "remove",
          "selection": "node_selection"
        }
      ],
      "mark": {
        "type": "text",
        "text": { 
          "conditions": [
            {
              "selectionIsEmpty": "node_selection.nodes",
              "value": { "expression": "[nodeLabel]"}
            },
            {
              "inSelection": "node_selection.nodes",
              "value": { "expression": "[nodeLabel]"}
            }
          ]
        },
        "opacity": {
          "conditions": [
            {
              "selectionIsEmpty": "node_selection.nodes",
              "value": 1
            },
            {
              "inSelection": "node_selection.nodes",
              "value": 1
            },
            {
              "inSelection": "neighbours.nodes",
              "value": 1
            }
          ],
          "value": 0.1
        },
        "dx": 10,
        "dy": 4,
        "cursor": "none"
      }
    }

  ]
}
